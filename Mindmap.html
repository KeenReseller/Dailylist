<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tab-Indented Mindmap</title>
<style>
    body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
        background: #1e1e1e;
        color: white;
    }

    /* --- Floating Mini Textbox --- */
    #inputBox {
        position: fixed;
        top: 10px;
        left: 10px;
        width: 260px;
        height: 150px;
        background: rgba(40, 40, 40, 0.9);
        border: 1px solid #444;
        padding: 10px;
        resize: vertical;
        color: white;
        font-size: 13px;
        z-index: 10;
        border-radius: 6px;
    }

    #generateBtn {
        position: fixed;
        top: 170px;
        left: 10px;
        background: #4caf50;
        padding: 8px 15px;
        border: none;
        color: white;
        cursor: pointer;
        z-index: 10;
        border-radius: 5px;
        font-size: 14px;
    }

    #canvas {
        position: absolute;
        top: 0;
        left: 0;
    }
</style>
</head>

<body>

<textarea id="inputBox" placeholder="Paste outline here..."></textarea>
<button id="generateBtn">Generate Mindmap</button>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.onresize = resize;

// Infinite drag variables
let offsetX = 0, offsetY = 0;
let isDragging = false;
let lastX, lastY;

// Drag to scroll IN ALL DIRECTIONS
canvas.addEventListener("mousedown", e => {
    isDragging = true;
    lastX = e.clientX;
    lastY = e.clientY;
});
canvas.addEventListener("mouseup", () => isDragging = false);
canvas.addEventListener("mousemove", e => {
    if (isDragging) {
        offsetX += (e.clientX - lastX);
        offsetY += (e.clientY - lastY);
        lastX = e.clientX;
        lastY = e.clientY;
        drawMindmap();
    }
});

// Parse outline â†’ tree
function parseText(text) {
    const lines = text.split("\n");
    let root = { text: "ROOT", level: -1, children: [] };
    let stack = [root];

    for (let line of lines) {
        if (!line.trim()) continue;

        let level = line.match(/^\t*/)[0].length;
        let node = { text: line.trim(), level, children: [] };

        while (stack[stack.length - 1].level >= level) {
            stack.pop();
        }

        stack[stack.length - 1].children.push(node);
        stack.push(node);
    }
    return root;
}

const colors = [
    "#FFC300", "#FF5733", "#C70039",
    "#900C3F", "#581845", "#1ABC9C",
    "#3498DB", "#9B59B6", "#E67E22"
];

function drawNode(node, x, y, depth) {
    let color = colors[depth % colors.length];

    ctx.fillStyle = color;
    ctx.strokeStyle = "white";
    ctx.lineWidth = 2;

    const w = node.text.length * 9 + 20;
    const h = 30;

    ctx.beginPath();
    ctx.rect(x, y, w, h);
    ctx.fill();
    ctx.stroke();

    ctx.fillStyle = "black";
    ctx.fillText(node.text, x + 10, y + 20);

    let nextY = y;

    for (let child of node.children) {
        nextY += 60;

        ctx.beginPath();
        ctx.moveTo(x + w / 2, y + h);
        ctx.lineTo(x + 180, nextY + 15);
        ctx.strokeStyle = "white";
        ctx.stroke();

        drawNode(child, x + 180, nextY, depth + 1);
    }
}

let tree;
function drawMindmap() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (tree) drawNode(tree, offsetX + canvas.width/2 - 150, offsetY + 60, 0);
}

document.getElementById("generateBtn").onclick = () => {
    tree = parseText(document.getElementById("inputBox").value);
    drawMindmap();
};
</script>
</body>
</html>
